---
title: HM - é¸¿è’™-çŠ¶æ€ç®¡ç†
---

# é¸¿è’™-çŠ¶æ€ç®¡ç†

## è‡ªå®šä¹‰æ„å»ºå‡½æ•°

### 1. æ„å»ºå‡½æ•°-@Builder 
> ArkUIè¿˜æä¾›äº†ä¸€ç§æ›´**è½»é‡**çš„UIå…ƒç´ å¤ç”¨æœºåˆ¶ `@Builder`ï¼Œå¯ä»¥å°†é‡å¤ä½¿ç”¨çš„UIå…ƒç´ æŠ½è±¡æˆä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ `build` æ–¹æ³•é‡Œè°ƒç”¨ã€‚

- ç»„ä»¶å†…å®šä¹‰ 
- å…¨å±€å®šä¹‰

1ï¼‰ç»„ä»¶å†…å®šä¹‰

```typescript
@Builder MyBuilderFunction() {}
```
```typescript
this.MyBuilderFunction()
```

2ï¼‰å…¨å±€å®šä¹‰

```typescript
@Builder function MyGlobalBuilderFunction() {}
```
```typescript
MyGlobalBuilderFunction()
```

ğŸ“•ğŸ“•ğŸ“• ç»ƒä¹ æ¡ˆä¾‹â†’å•†å“è¯¦æƒ…-æ›´å¤šæŒ‰é’®

    <img src="./images/27.png" width="240" />

- å¾…å®ç°é¡µé¢

```typescript
@Entry
@Component
struct Index {
  build() {
    Column() {
      GridRow({ columns: 2, gutter: 15 }) {
        GridCol({ span: 2 }) {
          Column() {
            Row() {
              Text('è¯„ä»·ï¼ˆ2000+ï¼‰')
                .layoutWeight(1)
                .fontWeight(600)
              // TODO
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }

        GridCol() {
          Column() {
            Row() {
              Text('æ¨è')
                .layoutWeight(1)
                .fontWeight(600)
              // TODO
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }

        GridCol() {
          Column() {
            Row() {
              Text('ä½“éªŒ')
                .layoutWeight(1)
                .fontWeight(600)
              // TODO
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }
      }
    }
    .height('100%')
    .padding(15)
    .backgroundColor('#f5f5f5')
  }
}
```
- ä½¿ç”¨ @Builder æå–UIç»“æ„

```typescript {5-15,26,43,60}
@Entry
@Component
struct Index {

  @Builder
  MoreBuilder () {
    Row() {
      Text('æŸ¥çœ‹æ›´å¤š')
        .fontSize(14)
        .fontColor('#666666')
      Image($r('app.media.ic_public_arrow_right'))
        .width(16)
        .fillColor('#666666')
    }
  }

  build() {
    Column() {
      GridRow({ columns: 2, gutter: 15 }) {
        GridCol({ span: 2 }) {
          Column() {
            Row() {
              Text('è¯„ä»·ï¼ˆ2000+ï¼‰')
                .layoutWeight(1)
                .fontWeight(600)
              this.MoreBuilder()
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }

        GridCol() {
          Column() {
            Row() {
              Text('æ¨è')
                .layoutWeight(1)
                .fontWeight(600)
              this.MoreBuilder()
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }

        GridCol() {
          Column() {
            Row() {
              Text('ä½“éªŒ')
                .layoutWeight(1)
                .fontWeight(600)
              this.MoreBuilder()
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }
      }
    }
    .height('100%')
    .padding(15)
    .backgroundColor('#f5f5f5')
  }
}
```

::: tip

å°ç»“ï¼š
- é‡åˆ°ééå†æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç»„ä»¶åˆ†æ•£ç€ç›¸åŒçš„UIç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨ `@Builder` æ›´è½»é‡

å…¶ä»–ï¼š
- `GridRow` `GridCol` æ …æ ¼å¸ƒå±€

:::




### 2. æ„å»ºå‡½æ•°-ä¼ å‚ä¼ é€’


1ï¼‰æŒ‰å€¼ä¼ é€’ï¼ˆåœºæ™¯ï¼šæ„å»ºä¸åŒçš„UIï¼‰

```typescript
@Builder MyBuilderFunction( title: string ) {}
```
```typescript
this.MyBuilderFunction('Title')
```

éœ€æ±‚ï¼šä¸åŒæ¿å—æŸ¥çœ‹æ›´å¤šæ–‡æ¡ˆä¸ä¸€æ ·

- è¯„ä»· å¥½è¯„ç‡ 98%
- æ¨è æŸ¥çœ‹å…¨éƒ¨
- ä½“éªŒ 4 æ¡æµ‹è¯„

    <img src="./images/29.png" width="240" />

```typescript
  @Builder
  MoreBuilder (title: string) {
    Row() {
      Text(title)
        .fontSize(14)
        .fontColor('#666666')
      Image($r('app.media.ic_public_arrow_right'))
        .width(16)
        .fillColor('#666666')
    }
  }
```

```typescript
this.MoreBuilder('å¥½è¯„ç‡ 98%')
this.MoreBuilder('æŸ¥çœ‹å…¨éƒ¨')
this.MoreBuilder('4 æ¡æµ‹è¯„')
```


2ï¼‰å¼•ç”¨ä¼ é€’ï¼ˆåœºæ™¯ï¼šå½“ä¼ é€’çš„æ•°æ®æ›´æ–°ï¼Œéœ€è¦æ›´æ–°UIï¼‰


éœ€æ±‚ï¼š
- ç‚¹å‡»æŒ‰é’®åæ¨¡æ‹ŸåŠ è½½å¥½è¯„ç‡æ•°æ®

    <img src="./images/30.png" width="240" />

```typescript {7-17,33,50,67}
@Entry
@Component
struct Index {
  @State
  rate: number = 0

  @Builder
  MoreBuilder(params: { title: string }) {
    Row() {
      Text(params.title)
        .fontSize(14)
        .fontColor('#666666')
      Image($r('app.media.ic_public_arrow_right'))
        .width(16)
        .fillColor('#666666')
    }
  }

  build() {
    Column() {
      Button('è·å–æ•°æ®')
        .margin({ bottom: 15 })
        .onClick(() => {
          this.rate = 99
        })
      GridRow({ columns: 2, gutter: 15 }) {
        GridCol({ span: 2 }) {
          Column() {
            Row() {
              Text('è¯„ä»·ï¼ˆ2000+ï¼‰')
                .layoutWeight(1)
                .fontWeight(600)
              this.MoreBuilder({ title: `å¥½è¯„ç‡ ${this.rate} %` })
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }

        GridCol() {
          Column() {
            Row() {
              Text('æ¨è')
                .layoutWeight(1)
                .fontWeight(600)
              this.MoreBuilder({ title: 'æŸ¥çœ‹å…¨éƒ¨' })
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }

        GridCol() {
          Column() {
            Row() {
              Text('ä½“éªŒ')
                .layoutWeight(1)
                .fontWeight(600)
              this.MoreBuilder({ title: '4 æ¡æµ‹è¯„' })
            }
            .padding(10)

            Row()
              .height(100)
          }
          .borderRadius(12)
          .backgroundColor('#fff')
        }
      }
    }
    .height('100%')
    .padding(15)
    .backgroundColor('#f5f5f5')
  }
}
```

::: tip

- ä½¿ç”¨ `@Builder` å¤ç”¨é€»è¾‘çš„æ—¶å€™ï¼Œæ”¯æŒä¼ å‚å¯ä»¥æ›´çµæ´»çš„æ¸²æŸ“UI
- å‚æ•°å¯ä»¥ä½¿ç”¨`çŠ¶æ€æ•°æ®`ï¼Œä¸è¿‡å»ºè®®é€šè¿‡å¯¹è±¡çš„æ–¹å¼ä¼ å…¥ `@Builder`

:::

### 3. æ„å»ºå‡½æ•°-@BuilderParam ä¼ é€’UI

> `@BuilderParam` è¯¥è£…é¥°å™¨ç”¨äºå£°æ˜ä»»æ„UIæè¿°çš„ä¸€ä¸ªå…ƒç´ ï¼Œç±»ä¼¼ slot å ä½ç¬¦

::: details å‰ç½®çŸ¥è¯†

ç»„ä»¶å±æ€§åˆå§‹åŒ–ï¼š
- å®šä¹‰ç»„ä»¶å£°æ˜å±æ€§  `title: string`
- ä½¿ç”¨ç»„ä»¶åˆå§‹åŒ–å±æ€§ `Comp({ title: string })`

:::

- å°¾éšé—­åŒ…åˆå§‹åŒ–ç»„ä»¶
    - ç»„ä»¶å†…æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä½¿ç”¨ `@BuilderParam` è£…é¥°çš„å±æ€§

- å‚æ•°åˆå§‹åŒ–ç»„ä»¶
    - ç»„ä»¶å†…æœ‰å¤šä¸ªä½¿ç”¨ `@BuilderParam` è£…é¥°å™¨å±æ€§


1ï¼‰å°¾éšé—­åŒ…åˆå§‹åŒ–ç»„ä»¶(é»˜è®¤æ’æ§½)

éœ€æ±‚ï¼š
- æ ‡é¢˜æ–‡å­—å’Œæ›´å¤šæ–‡æ¡ˆé€šè¿‡å±æ€§ä¼ å…¥
- å†…å®¹ç»“æ„éœ€è¦ä¼ å…¥

    <img src="./images/31.png" width="240" />

```typescript {5-13,31,47,51-53,57-59}
@Component
struct PanelComp {
  title: string
  more: string
  @BuilderParam
  panelContent: () => void = this.DefaultPanelContent

  // å¤‡ç”¨ Builder
  @Builder
  DefaultPanelContent () {
    Text('é»˜è®¤å†…å®¹')
  }

  build() {
    Column() {
      Row() {
        Text(this.title)
          .layoutWeight(1)
          .fontWeight(600)
        Row() {
          Text(this.more)
            .fontSize(14)
            .fontColor('#666666')
          Image($r('app.media.ic_public_arrow_right'))
            .width(16)
            .fillColor('#666666')
        }
      }
      .padding(10)

      Row() {
        this.panelContent()
      }
      .height(100)
    }
    .borderRadius(12)
    .backgroundColor('#fff')
  }
}

@Entry
@Component
struct Index {
  build() {
    Column() {
      GridRow({ columns: 2, gutter: 15 }) {
        GridCol({ span: 2 }) {
          PanelComp({ title: 'è¯„ä»·ï¼ˆ2000+ï¼‰', more: 'å¥½è¯„ç‡98%' })
        }

        GridCol() {
          PanelComp({ title: 'æ¨è', more: 'æŸ¥çœ‹å…¨éƒ¨' }){
            Text('æ¨èå†…å®¹')
          }
        }

        GridCol() {
          PanelComp({ title: 'ä½“éªŒ', more: '4 æ¡æµ‹è¯„' }){
            Text('ä½“éªŒå†…å®¹')
          }
        }
      }
    }
    .height('100%')
    .padding(15)
    .backgroundColor('#f5f5f5')
  }
}
```

2ï¼‰å‚æ•°åˆå§‹åŒ–ç»„ä»¶ï¼ˆå…·åæ’æ§½ï¼‰

éœ€æ±‚ï¼šéœ€è¦ä¼ å…¥å†…å®¹ç»“æ„å’Œåº•éƒ¨ç»“æ„

    <img src="./images/32.png" width="240" />

```typescript {5-8,28,32,44-51,57-62}
@Component
struct PanelComp {
  title: string
  more: string
  @BuilderParam
  panelContent: () => void
  @BuilderParam
  panelFooter: () => void

  build() {
    Column() {
      Row() {
        Text(this.title)
          .layoutWeight(1)
          .fontWeight(600)
        Row() {
          Text(this.more)
            .fontSize(14)
            .fontColor('#666666')
          Image($r('app.media.ic_public_arrow_right'))
            .width(16)
            .fillColor('#666666')
        }
      }
      .padding(10)

      Row() {
        this.panelContent()
      }
      .height(100)
      Row() {
        this.panelFooter()
      }
      .height(50)
    }
    .borderRadius(12)
    .backgroundColor('#fff')
  }
}

@Entry
@Component
struct Index {
  @Builder
  ContentBuilderA() {
    Text('è¯„ä»·å†…å®¹')
  }
  @Builder
  FooterBuilderA() {
    Text('è¯„ä»·åº•éƒ¨')
  }

  build() {
    Column() {
      GridRow({ columns: 2, gutter: 15 }) {
        GridCol({ span: 2 }) {
          PanelComp({
            title: 'è¯„ä»·ï¼ˆ2000+ï¼‰',
            more: 'å¥½è¯„ç‡98%',
            panelFooter: this.FooterBuilderA,
            panelContent: this.ContentBuilderA
          })
        }

        // GridCol() {
        //   PanelComp({ title: 'æ¨è', more: 'æŸ¥çœ‹å…¨éƒ¨' }){
        //     Text('æ¨èå†…å®¹')
        //   }
        // }
        //
        // GridCol() {
        //   PanelComp({ title: 'ä½“éªŒ', more: '4 æ¡æµ‹è¯„' }){
        //     Text('ä½“éªŒå†…å®¹')
        //   }
        // }
      }
    }
    .height('100%')
    .padding(15)
    .backgroundColor('#f5f5f5')
  }
}
```

::: tip

- å½“å­ç»„ä»¶ä½¿ç”¨ä¸€ä¸ª `@BuilderParam` çš„æ—¶å€™ï¼Œä½¿ç”¨ç»„ä»¶çš„æ—¶å€™åœ¨å°¾éš `{}` æ’å…¥UIç»“æ„
- å½“å­ç»„ä»¶ä½¿ç”¨å¤šä¸ª `@BuilderParam` çš„æ—¶å€™ï¼Œä½¿ç”¨ç»„ä»¶çš„æ—¶å€™ `Comp({ xxx: this.builderFn })` ä¼ å…¥
- å­ç»„ä»¶æœ¬èº«å¯ä»¥æä¾›ä¸€ä¸ªé»˜è®¤çš„ `@Builder` å‡½æ•°ä½œä¸º `@BuilderParam` å¤‡ç”¨å‡½æ•°ï¼Œå½“åšå¤‡ç”¨å†…å®¹ä½¿ç”¨

:::


### 4. æ„å»ºå‡½æ•°-ç³»ç»Ÿç»„ä»¶è‡ªå®šä¹‰UI

> åœ¨ä¸€äº›ç³»ç»Ÿç»„ä»¶ä¸­ï¼Œæ ¹æ®é…ç½®æ— æ³•è¾¾åˆ°é¢„æœŸUIï¼Œå¯ä»¥ä½¿ç”¨ @Builder æ„å»ºå‡½æ•°è‡ªå®šä¹‰UIï¼Œå‰æè¯¥ç»„ä»¶æ”¯æŒè‡ªå®šä¹‰ã€‚

    <img src="./images/28.png" width="240" />

éœ€æ±‚ï¼šè‡ªå®šä¹‰ `Tabs` ç»„ä»¶çš„ `TabBar` UIç»“æ„

```typescript
class ToolBarItem {
  defaultIcon: string | Resource
  activeIcon: string | Resource
  label: string
}

@Entry
@Component
struct Index {
  @State
  activeIndex: number = 0
  toolBars: ToolBarItem[] = [
    { defaultIcon: $r('app.media.home'), activeIcon: $r('app.media.home_select'), label: 'é¦–é¡µ' },
    { defaultIcon: $r('app.media.project'), activeIcon: $r('app.media.project_select'), label: 'é¡¹ç›®' },
    { defaultIcon: $r('app.media.interview'), activeIcon: $r('app.media.interview_select'), label: 'é¢ç»' },
    { defaultIcon: $r('app.media.mine'), activeIcon: $r('app.media.mine_select'), label: 'æˆ‘çš„' }
  ]

  @Builder
  TabBarBuilder(item: ToolBarItem, index: number) {
    Column() {
      Image(this.activeIndex === index ? item.activeIcon : item.defaultIcon)
        .width(24)
      Text(item.label)
        .fontSize(12)
        .margin({ top: 4 })
        .lineHeight(12)
        .fontColor(this.activeIndex === index ? '#000' : '#aaa')
    }
  }

  build() {
    Tabs() {
      ForEach(this.toolBars, (item: ToolBarItem, index: number) => {
        TabContent() {
          Text(index.toString())
        }
        .tabBar(this.TabBarBuilder(item, index))
      })
    }
    .barPosition(BarPosition.End)
    .onChange(index => this.activeIndex = index)
  }
}
```


## ç»„ä»¶çŠ¶æ€å…±äº«

### 1. çŠ¶æ€å…±äº«-çˆ¶å­å•å‘

> `@Prop` è£…é¥°çš„å˜é‡å¯ä»¥å’Œçˆ¶ç»„ä»¶å»ºç«‹å•å‘çš„åŒæ­¥å…³ç³»ã€‚`@Prop` è£…é¥°çš„å˜é‡æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯å˜åŒ–ä¸ä¼šåŒæ­¥å›å…¶çˆ¶ç»„ä»¶ã€‚


```typescript {26,27}
@Entry
@Component
struct Index {

  @State
  money: number = 0

  build() {
    Column({ space: 20 }){
      Text('çˆ¶ç»„ä»¶ï¼š' + this.money)
        .onClick(() => {
          this.money ++
        })
      Child({ money: this.money })
    }
    .width('100%')
    .height('100%')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct Child {

  @Prop
  money: number

  build() {
    Text('å­ç»„ä»¶ï¼š' + this.money)
      .onClick(() => {
        this.money ++
      })
  }
}
```

::: tip

- æ”¯æŒç±»å‹ `stringã€numberã€booleanã€enum` ç±»å‹
- å­ç»„ä»¶å¯ä¿®æ”¹ `Prop` æ•°æ®å€¼ï¼Œä½†ä¸åŒæ­¥åˆ°çˆ¶ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶æ›´æ–°åè¦†ç›–å­ç»„ä»¶ `Prop` æ•°æ®
- å­ç»„ä»¶å¯ä»¥åˆå§‹åŒ–é»˜è®¤å€¼ï¼Œ**æ³¨æ„ï¼šç›®å‰ç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ï¼Œè¯·å¿½ç•¥ï¼Œä¸‹ä¸ªç‰ˆæœ¬å°†ä¿®å¤**

:::


### 2. çŠ¶æ€å…±äº«-çˆ¶å­åŒå‘

> å­ç»„ä»¶ä¸­è¢«@Linkè£…é¥°çš„å˜é‡ä¸å…¶çˆ¶ç»„ä»¶ä¸­å¯¹åº”çš„æ•°æ®æºå»ºç«‹åŒå‘æ•°æ®ç»‘å®šã€‚


1ï¼‰ç®€å•ç±»å‹ `stringã€numberã€booleanã€enum`

```typescript {14,26,27}
@Entry
@Component
struct Index {

  @State
  money: number = 0

  build() {
    Column({ space: 20 }){
      Text('çˆ¶ç»„ä»¶ï¼š' + this.money)
        .onClick(() => {
          this.money ++
        })
      Child({ money: $money })
    }
    .width('100%')
    .height('100%')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct Child {

  @Link
  money: number

  build() {
    Text('å­ç»„ä»¶ï¼š' + this.money)
      .onClick(() => {
        this.money ++
      })
  }
}
```

2ï¼‰å¤æ‚ç±»å‹ `Objectã€class`

```typescript {1-4,10-11,19,31-32}
class Person {
  name: string
  age: number
}

@Entry
@Component
struct Index {

  @State
  person: Person = { name: 'jack', age: 18 }

  build() {
    Column({ space: 20 }){
      Text('çˆ¶ç»„ä»¶ï¼š' + `${this.person.name} ä»Šå¹´ ${ this.person.age } å²`)
        .onClick(() => {
          this.person.age ++
        })
      Child({ person: $person })
    }
    .width('100%')
    .height('100%')
    .alignItems(HorizontalAlign.Center)
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct Child {

  @Link
  person: Person

  build() {
    Text('å­ç»„ä»¶ï¼š' +  `${this.person.name} ä»Šå¹´ ${ this.person.age } å²`)
      .onClick(() => {
        this.person.age ++
      })
  }
}
```


::: tip

- çˆ¶ç»„ä»¶ä¼ å€¼çš„æ—¶å€™éœ€è¦ `this.` æ”¹æˆ `$`ï¼Œå­ç»„ä»¶ `@Link` ä¿®é¥°æ•°æ®

:::


### 3. çŠ¶æ€å…±äº«-åä»£ç»„ä»¶


> `@Provide` å’Œ `@Consume`ï¼Œåº”ç”¨äºä¸åä»£ç»„ä»¶çš„åŒå‘æ•°æ®åŒæ­¥ï¼Œåº”ç”¨äºçŠ¶æ€æ•°æ®åœ¨å¤šä¸ªå±‚çº§ä¹‹é—´ä¼ é€’çš„åœºæ™¯ã€‚


1ï¼‰é€šè¿‡ç›¸åŒçš„å˜é‡åç»‘å®š

```typescript {4-5,24-25,40-41}
@Entry
@Component
struct Index {
  @Provide
  money: number = 0

  build() {
    Column({ space: 20 }) {
      Text('çˆ¶ç»„ä»¶ï¼š' + this.money)
        .onClick(() => {
          this.money++
        })
      Parent()
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct Parent {
  @Consume
  money: number

  build() {
    Column({ space: 20 }) {
      Text('çˆ¶ç»„ä»¶ï¼š' + this.money)
        .onClick(() => {
          this.money++
        })
      Child()
    }
  }
}

@Component
struct Child {
  @Consume
  money: number

  build() {
    Text('å­ç»„ä»¶ï¼š' + this.money)
      .onClick(() => {
        this.money++
      })
  }
}
```


::: tip

- `Objectã€classã€stringã€numberã€booleanã€enum` ç±»å‹å‡æ”¯æŒ
- é€šè¿‡ç›¸åŒçš„å˜é‡åˆ«åç»‘å®š `@Provide('key')` å’Œ `@Consume('key')` keyéœ€è¦ä¿æŒä¸€è‡´

:::


### 4. çŠ¶æ€å…±äº«-çŠ¶æ€ç›‘å¬å™¨

> å¦‚æœå¼€å‘è€…éœ€è¦å…³æ³¨æŸä¸ªçŠ¶æ€å˜é‡çš„å€¼æ˜¯å¦æ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨ `@Watch` ä¸ºçŠ¶æ€å˜é‡è®¾ç½®å›è°ƒå‡½æ•°ã€‚

- `@Stateã€@Propã€@Link` ç­‰è£…é¥°å™¨åœ¨ `@Watch` è£…é¥°ä¹‹å‰


```typescript {5-7}
import promptAction from '@ohos.promptAction'

@Component
struct Child {
  @Prop
  @Watch('onActiveIndex')
  activeIndex: number

  onActiveIndex() {
    promptAction.showToast({ message: 'ç›‘å¬å˜åŒ–' })
  }

  build() {
    Column() {
      Text('Child' + this.activeIndex)
    }
  }
}

@Entry
@Component
struct Index {
  @State activeIndex: number = 0

  onChange (index: number) {
    this.activeIndex = index
    promptAction.showToast({ message: 'ç‚¹å‡»' })
  }

  build() {
    Navigation() {
      Child({ activeIndex: this.activeIndex })
    }.toolBar({
      items: [
        { value: 'é¦–é¡µ', action: () => this.onChange(0) },
        { value: 'æˆ‘çš„', action: () => this.onChange(1) },
      ]
    })
  }
}
```

::: tip

- åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ï¼Œ@Watchè£…é¥°çš„æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨

:::


### 5. @Observedä¸@ObjectLink

> ä¹‹å‰æˆ‘ä»¬é€šè¿‡ **èµ‹å€¼çš„æ–¹å¼** ä¿®æ”¹åµŒå¥—å¯¹è±¡æˆ–å¯¹è±¡æ•°ç»„è¿™ç±»å¤æ‚æ•°æ®æ¥æ›´æ–°UIï¼Œä¼šå½±å“å¯¹è±¡å¯¹åº”æ‰€æœ‰UIæ›´æ–°ï¼›
> é€šè¿‡ `@Observed `ä¸ `@ObjectLink` å¯ä»¥ä¼˜åŒ–è¿™ä¸ªé—®é¢˜ï¼›

ä½¿ç”¨æ­¥éª¤ï¼š
- ç±» `class` æ•°æ®æ¨¡æ‹Ÿéœ€è¦å®šä¹‰é€šè¿‡æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ `@Observed` ä¿®é¥°è¿™ä¸ªç±»
- åˆå§‹åŒ–æ•°æ®ï¼šéœ€è¦é€šè¿‡åˆå§‹åŒ–æ„é€ å‡½æ•°çš„æ–¹å¼æ·»åŠ 
- é€šè¿‡ `@ObjectLink` å…³è”å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹è¢«å…³è”å¯¹è±¡æ¥æ›´æ–°UI


éœ€æ±‚ï¼šæ”¹é€ ä¸‹çŸ¥ä¹è¯„è®ºæ¡ˆä¾‹

1ï¼‰å®šä¹‰æ„é€ å‡½æ•°å’Œä½¿ç”¨`@Observed` ä¿®é¥°ç¬¦ï¼Œä»¥åŠåˆå§‹åŒ–æ•°æ®

```typescript {1,12-16,20,29,38,47,56,65} title="models/index.ets"
@Observed
export class ReplyItem {
  id: number
  avatar: string | Resource
  author: string
  content: string
  time: string
  area: string
  likeNum: number
  likeFlag?: boolean

  constructor(item: ReplyItem) {
    for (const key in item) {
      this[key] = item[key]
    }
  }
}

export const replyList: ReplyItem[] = [
  new ReplyItem({
    id: 1,
    avatar: 'https://picx.zhimg.com/027729d02bdf060e24973c3726fea9da_l.jpg?source=06d4cd63',
    author: 'åæ‰§ç‹‚-å¦„æƒ³å®¶',
    content: 'æ›´ä½•å†µè¿˜åˆ†åˆ°ä¸€ä¸ªæ‘©æ´›å“¥[æƒŠå–œ]',
    time: '11-30',
    area: 'æµ·å—',
    likeNum: 34
  }),
  new ReplyItem({
    id: 2,
    avatar: 'https://pic1.zhimg.com/v2-5a3f5190369ae59c12bee33abfe0c5cc_xl.jpg?source=32738c0c',
    author: 'William',
    content: 'å½“å¹´å¸Œè…Šå¯æ˜¯æŠŠ1ï¼š0å‘æŒ¥åˆ°æè‡´äº†',
    time: '11-29',
    area: 'åŒ—äº¬',
    likeNum: 58
  }),
  new ReplyItem({
    id: 3,
    avatar: 'https://picx.zhimg.com/v2-e6f4605c16e4378572a96dad7eaaf2b0_l.jpg?source=06d4cd63',
    author: 'Andy Garcia',
    content: 'æ¬§æ´²æ¯å…¶å®16é˜Ÿçƒé˜Ÿæ‰“æ­£èµ›å·²ç»å·®ä¸å¤šï¼Œ24é˜Ÿæ‰“æ­£èµ›æ„å‘³ç€æ­£èµ›é˜¶æ®µåœ¨å°ç»„èµ›ä¸€æ ·æœ‰å¼±é˜Ÿã€‚',
    time: '11-28',
    area: 'ä¸Šæµ·',
    likeNum: 10
  }),
  new ReplyItem({
    id: 4,
    avatar: 'https://picx.zhimg.com/v2-53e7cf84228e26f419d924c2bf8d5d70_l.jpg?source=06d4cd63',
    author: 'æ­£å®—å¥½é±¼å¤´',
    content: 'ç¡®å®çœ¼çº¢å•Šï¼Œäºšæ´²å°±æ²¡è¿™ç§çƒé˜Ÿï¼Œè®©ä¸­å›½é˜Ÿåˆ·',
    time: '11-27',
    area: 'é¦™æ¸¯',
    likeNum: 139
  }),
  new ReplyItem({
    id: 5,
    avatar: 'https://pic1.zhimg.com/v2-eeddfaae049df2a407ff37540894c8ce_l.jpg?source=06d4cd63',
    author: 'æŸ±å­å“¥',
    content: 'æˆ‘æ˜¯æ”¯æŒæ‰©å¤§çš„ï¼Œäºšæ´²æ¯æ¬§æ´²æ¯æ‰©åˆ°32é˜Ÿï¼Œä¸–ç•Œæ¯æ‰©åˆ°64é˜Ÿæ‰æ˜¯å¥½çš„ï¼Œä¸–ç•Œä¸Šæœ‰è¶…è¿‡200æ”¯é˜Ÿä¼ï¼Œæ¬§æ´²åŒº55æ”¯é˜Ÿä¼ï¼Œäºšæ´²åŒº47æ”¯é˜Ÿä¼ï¼Œå³ä½¿å¦‚æ­¤ä¹Ÿå°±å…­æˆå‡ºç°ç‡',
    time: '11-27',
    area: 'æ—§é‡‘å±±',
    likeNum: 29
  }),
  new ReplyItem({
    id: 6,
    avatar: 'https://picx.zhimg.com/v2-fab3da929232ae911e92bf8137d11f3a_l.jpg?source=06d4cd63',
    author: 'é£è½©é€¸',
    content: 'ç¦æ­¢æ¬§æ´²æ¯æ‰©å†›ä¹‹å‰ï¼Œåº”è¯¥å…ˆç¦æ­¢ä¸–ç•Œæ¯æ‰©å†›ï¼Œæˆ–è€…è‡³å°‘æŠŠäºšæ´²åé¢ä¸€åŠç»™æ¬§æ´²ã€‚',
    time: '11-26',
    area: 'é‡Œçº¦',
    likeNum: 100
  })
]
```

2ï¼‰åµŒå¥—çš„å¯¹è±¡ï¼Œæˆ–è€…æ•°ç»„ä¸­çš„å¯¹è±¡ï¼Œä¼ å…¥å­ç»„ä»¶ï¼Œç»„ä»¶ä½¿ç”¨ `@ObjectLink` ä¿®é¥°ç¬¦è·å–æ•°æ®

```typescript {14,82-95} title="pages/Index.ets"
import promptAction from '@ohos.promptAction'
import { ReplyItem, replyList } from '../models'


@Entry
@Component
struct Index {
  @State
  replyList: ReplyItem[] = replyList
  @State
  content: string = ''

  onReply() {
    const reply: ReplyItem = new ReplyItem({
      id: Math.random(),
      content: this.content,
      author: 'Zhousg',
      avatar: $r('app.media.avatar'),
      time: '12-01',
      likeNum: 0,
      area: 'åŒ—äº¬'
    })
    this.replyList.unshift(reply)
    this.content = ''
    promptAction.showToast({ message: 'å›å¤æˆåŠŸ' })
  }

  build() {
    Stack() {
      Scroll() {
        Column() {
          NavComp()
          CommentComp()
          // space
          Divider()
            .strokeWidth(8)
            .color('#f5f5f5')
          // reply
          Column() {
            Text('å›å¤ 7')
              .width('100%')
              .margin({ bottom: 15 })
              .fontWeight(500)
            ForEach(this.replyList, (item: ReplyItem) => {
              ReplyComp({ item })
            })
          }
          .padding({ left: 15, right: 15, top: 15 })
        }
      }
      .padding({ bottom: 50 })

      Row() {
        TextInput({ placeholder: 'å›å¤~', text: this.content })
          .placeholderColor('#c3c4c5')
          .layoutWeight(1)
          .onChange((value) => {
            this.content = value
          })
        Text('å‘å¸ƒ')
          .fontSize(14)
          .fontColor('#09f')
          .margin({ left: 15 })
          .onClick(() => {
            this.onReply()
          })
      }
      .width('100%')
      .height(50)
      .padding({ left: 15, right: 15 })
      .position({ y: '100%' })
      .translate({ y: -50 })
      .backgroundColor('#fff')
      .border({ width: { top: 0.5 }, color: '#e4e4e4' })
    }

  }
}

@Component
struct ReplyComp {
  @ObjectLink
  item: ReplyItem

  onLike() {
    if (this.item.likeFlag) {
      this.item.likeNum--
      this.item.likeFlag = false
      promptAction.showToast({ message: 'å–æ¶ˆç‚¹èµ' })
    } else {
      this.item.likeNum++
      this.item.likeFlag = true
      promptAction.showToast({ message: 'ç‚¹èµæˆåŠŸ' })
    }
  }

  build() {
    Row() {
      Image(this.item.avatar)
        .width(32)
        .height(32)
        .borderRadius(16)
      Column() {
        Text(this.item.author)
          .fontSize(15)
          .fontWeight(FontWeight.Bold)
          .margin({ bottom: 5 })
        Text(this.item.content)
          .margin({ bottom: 5 })
          .fontColor('#565656')
          .lineHeight(20)
        Row() {
          Text(`${this.item.time}â€¢IP å±åœ°${this.item.area}`)
            .layoutWeight(1)
            .fontSize(14)
            .fontColor('#c3c4c5')
          Row() {
            Image($r('app.media.heart'))
              .width(14)
              .height(14)
              .fillColor(this.item.likeFlag ? '#ff6600' : '#c3c4c5')
              .margin({ right: 4 })
            Text(this.item.likeNum.toString())
              .fontSize(14)
              .fontColor(this.item.likeFlag ? '#ff6600' : '#c3c4c5')
          }
          .onClick(() => {
            this.onLike()
          })
        }
      }
      .layoutWeight(1)
      .padding({ left: 10 })
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .padding({ bottom: 15 })
    .alignItems(VerticalAlign.Top)
  }
}

@Component
struct NavComp {
  build() {
    // nav
    Row() {
      Row() {
        Image($r('app.media.ic_public_arrow_left'))
          .width(12)
          .height(12)
          .fillColor('#848484')
      }
      .width(24)
      .height(24)
      .borderRadius(12)
      .backgroundColor('#f5f5f5')
      .justifyContent(FlexAlign.Center)
      .margin({ left: 13 })

      Text('è¯„è®ºå›å¤')
        .padding({ right: 50 })
        .textAlign(TextAlign.Center)
        .fontSize(18)
        .layoutWeight(1)
    }
    .height(50)

  }
}

@Component
struct CommentComp {
  build() {
    // comment
    Row() {
      Image('https://picx.zhimg.com/1754b6bd9_xl.jpg?source=c885d018')
        .width(32)
        .height(32)
        .borderRadius(16)
      Column() {
        Text('æ¬§æ´²è¶³çƒé”¦æ ‡èµ›')
          .fontSize(15)
          .fontWeight(FontWeight.Bold)
          .margin({ bottom: 5 })
        Text('14-0ï¼æ¬§æ´²æ¯è¶…çº§æƒ¨æ¡ˆ+åˆ·çˆ†çºªå½•ï¼å§†å·´ä½©å¸½å­æˆæ³•ï¼Œæ³•å›½7è¿èƒœï¼Œæ€ä¹ˆè¯„ä»·è¿™åœºæ¯”èµ›ï¼Ÿ')
          .margin({ bottom: 5 })
          .fontColor('#565656')
          .lineHeight(20)
        Row() {
          Text('10-21â€¢IP å±åœ°è¾½å®')
            .layoutWeight(1)
            .fontSize(14)
            .fontColor('#c3c4c5')
          Row() {
            Image($r('app.media.heart'))
              .width(14)
              .height(14)
              .fillColor('#c3c4c5')
              .margin({ right: 4 })
            Text('100')
              .fontSize(14)
              .fontColor('#c3c4c5')
          }
        }
      }
      .layoutWeight(1)
      .padding({ left: 10 })
      .alignItems(HorizontalAlign.Start)
    }
    .width('100%')
    .padding({ left: 15, right: 15, bottom: 15 })
    .alignItems(VerticalAlign.Top)
  }
}
```

::: tip æ³¨æ„ï¼š

- å¯¹è±¡éœ€è¦é€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–
- éœ€è¦åµŒå¥—ç»„ä»¶ï¼Œå› ä¸ºéœ€è¦ä½¿ç”¨ `@ObjectLink`

:::


## åº”ç”¨çŠ¶æ€

::: tip

å…³äºåº”ç”¨çŠ¶æ€ç›¸å…³çš„å†…å®¹éœ€è¦ä½¿ç”¨æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºè°ƒè¯•

:::

### 1. UIAbilityå†…çŠ¶æ€-LocalStorage

> `LocalStorage` æ˜¯é¡µé¢çº§çš„UIçŠ¶æ€å­˜å‚¨ï¼Œé€šè¿‡ `@Entry` è£…é¥°å™¨æ¥æ”¶çš„å‚æ•°å¯ä»¥åœ¨é¡µé¢å†…å…±äº«åŒä¸€ä¸ª `LocalStorage` å®ä¾‹ã€‚ `LocalStorage` ä¹Ÿå¯ä»¥åœ¨ `UIAbility` å†…ï¼Œé¡µé¢é—´å…±äº«çŠ¶æ€ã€‚


1ï¼‰é¡µé¢å†…å…±äº«

- åˆ›å»º `LocalStorage` å®ä¾‹ï¼š`const storage = new LocalStorage({ key: value })`
- å•å‘ `@LocalStorageProp('user')` ç»„ä»¶å†…å¯å˜
- åŒå‘ `@LocalStorageLink('user')` å…¨å±€å‡å¯å˜

```typescript {5-7,9,12-13,32-33,48-49}
class User {
  name?: string
  age?: number
}
const storage = new LocalStorage({
  user: { name: 'jack', age: 18 }
})

@Entry(storage)
@Component
struct Index {
  @LocalStorageProp('user')
  user: User = {}

  build() {
    Column({ space: 15 }){
      Text('Indexï¼š')
      Text(this.user.name + this.user.age)
      Divider()
      ChildA()
      Divider()
      ChildB()
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct ChildA {
  @LocalStorageProp('user')
  user: User = {}

  build() {
    Column({ space: 15 }){
      Text('ChildAï¼š')
      Text(this.user.name + this.user.age)
        .onClick(()=>{
          this.user.age ++
        })
    }
  }
}

@Component
struct ChildB {
  @LocalStorageLink('user')
  user: User = {}

  build() {
    Column({ space: 15 }){
      Text('ChildBï¼š')
      Text(this.user.name + this.user.age)
        .onClick(()=>{
          this.user.age ++
        })
    }
  }
}
```

2ï¼‰é¡µé¢é—´å…±äº«

- åœ¨ `UIAbility` åˆ›å»º `LocalStorage` é€šè¿‡ `loadContent` æä¾›ç»™åŠ è½½çš„çª—å£
- åœ¨é¡µé¢ä½¿ç”¨ `const storage = LocalStorage.GetShared()` å¾—åˆ°å®ä¾‹ï¼Œé€šè¿‡ `@Entry(storage)` ä¼ å…¥é¡µé¢


```diff title="entryAbility/EntryAbility.ts"
+  storage = new LocalStorage({
+    user: { name: 'jack', age: 18 }
+  })

  onWindowStageCreate(windowStage: window.WindowStage) {
    // Main window is created, set main page for this ability
    hilog.info(0x0000, 'testTag', '%{public}s', 'Ability onWindowStageCreate');

+    windowStage.loadContent('pages/Index', this.storage , (err, data) => {
      if (err.code) {
        hilog.error(0x0000, 'testTag', 'Failed to load the content. Cause: %{public}s', JSON.stringify(err) ?? '');
        return;
      }
      hilog.info(0x0000, 'testTag', 'Succeeded in loading the content. Data: %{public}s', JSON.stringify(data) ?? '');
    });
  }
```

```typescript title="models/index.ets"
export class User {
  name?: string
  age?: number
}
```

```typescript {2,4} title="pages/Index.ets"
import { User } from '../models'
const storage = LocalStorage.GetShared()

@Entry(storage)
@Component
struct Index {
  @LocalStorageProp('user')
  user: User = {}

  build() {
    Column({ space: 15 }) {
      Text('Indexï¼š')
      Text(this.user.name + this.user.age)
        .onClick(()=>{
          this.user.age ++
        })
      Navigator({ target: 'pages/OtherPage' }){
        Text('Go Other Page')
      }
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

```typescript {2,4} title="pages/OtherPage.ets"
import { User } from '../models'
const storage = LocalStorage.GetShared()

@Entry(storage)
@Component
struct OtherPage {
  @LocalStorageLink('user')
  user: User = {}

  build() {
    Column({ space: 15 }) {
      Text('OtherPageï¼š')
      Text(this.user.name + this.user.age)
        .onClick(()=>{
          this.user.age ++
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

::: tip

- é¡µé¢é—´å…±äº«éœ€è¦è¦æ¨¡æ‹Ÿå™¨æµ‹è¯•
- åº”ç”¨é€»è¾‘ä¸­ä½¿ç”¨å‚è€ƒ [é“¾æ¥](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-localstorage-0000001524537149-V3#section614118685518)

:::


### 2. åº”ç”¨çŠ¶æ€-AppStorage

> `AppStorage` æ˜¯åº”ç”¨å…¨å±€çš„UIçŠ¶æ€å­˜å‚¨ï¼Œæ˜¯å’Œåº”ç”¨çš„è¿›ç¨‹ç»‘å®šçš„ï¼Œç”±UIæ¡†æ¶åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸ºåº”ç”¨ç¨‹åºUIçŠ¶æ€å±æ€§æä¾›ä¸­å¤®å­˜å‚¨ã€‚

- å¦‚æœæ˜¯åˆå§‹åŒ–ä½¿ç”¨ `AppStorage.SetOrCreate(key,value)`
- å•å‘ `@StorageProp('user')` ç»„ä»¶å†…å¯å˜
- åŒå‘ `@StorageLink('user')` å…¨å±€å‡å¯å˜

1ï¼‰é€šè¿‡UIè£…é¥°å™¨ä½¿ç”¨

```typescript {3,8-10,30-31}
import { User } from '../models'

AppStorage.SetOrCreate<User>('user', { name: 'jack', age: 18 })

@Entry
@Component
struct Index {
  @StorageProp('user')
  // å¯å¿½ç•¥ï¼Œç¼–è¾‘å™¨ç±»å‹é”™è¯¯
  user: User = {}

  build() {
    Column({ space: 15 }) {
      Text('Indexï¼š')
      Text(this.user.name + this.user.age)
        .onClick(() => {
          this.user.age++
        })
      Divider()
      ChildA()
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}

@Component
struct ChildA {
  @StorageLink('user')
  user: User = {}

  build() {
    Column({ space: 15 }){
      Text('ChildAï¼š')
      Text(this.user.name + this.user.age)
        .onClick(()=>{
          this.user.age ++
        })
    }
  }
}
```

2ï¼‰é€šè¿‡é€»è¾‘ä½¿ç”¨

- `AppStorage.Get<ValueType>(key)` è·å–æ•°æ®
- `AppStorage.Set<ValueType>(key,value)` è¦†ç›–æ•°æ®
- `const link: SubscribedAbstractProperty<ValueType> = AppStorage.Link(key)` è¦†ç›–æ•°æ®
    - `link.set(value)` ä¿®æ”¹
    - `link.get()` è·å–

```typescript {23,31,40}
import promptAction from '@ohos.promptAction'
import { User } from '../models'

AppStorage.SetOrCreate<User>('user', { name: 'jack', age: 18 })

@Entry
@Component
struct Index {
  @StorageLink('user')
  user: User = {}

  build() {
    Column({ space: 15 }) {
      Text('Indexï¼š')
      Text(this.user.name + this.user.age)
        .onClick(() => {
          this.user.age++
        })
      Divider()
      Text('Get()')
        .onClick(() => {
          // ä»…è·å–
          const user = AppStorage.Get<User>('user')
          promptAction.showToast({
            message: JSON.stringify(user)
          })
        })
      Text('Set()')
        .onClick(() => {
          // ç›´æ¥è®¾ç½®
          AppStorage.Set<User>('user', {
            name: 'tom',
            age: 100
          })
          // è§‚å¯Ÿé¡µé¢æ›´æ–°æ²¡
        })
      Text('Link()')
        .onClick(() => {
          // è·å–userçš„prop
          const user: SubscribedAbstractProperty<User> = AppStorage.Link('user')
          user.set({
            name: user.get().name,
            // è·å–åä¿®æ”¹
            age: user.get().age + 1
          })
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

### 3. çŠ¶æ€æŒä¹…åŒ–-PersistentStorage

> `PersistentStorage` å°†é€‰å®šçš„ `AppStorage` å±æ€§ä¿ç•™åœ¨è®¾å¤‡ç£ç›˜ä¸Šã€‚  

::: details
UIå’Œä¸šåŠ¡é€»è¾‘ä¸ç›´æ¥è®¿é—® `PersistentStorage` ä¸­çš„å±æ€§ï¼Œæ‰€æœ‰å±æ€§è®¿é—®éƒ½æ˜¯å¯¹ `AppStorage` çš„è®¿é—®ï¼Œ`AppStorage` ä¸­çš„æ›´æ”¹ä¼šè‡ªåŠ¨åŒæ­¥åˆ° `PersistentStorage`ã€‚
:::

::: warning
- æ”¯æŒï¼šnumber, string, boolean, enum ç­‰ç®€å•ç±»å‹; 
- å¦‚æœï¼šè¦æ”¯æŒå¯¹è±¡ç±»å‹ï¼Œå¯ä»¥è½¬æ¢æˆjsonå­—ç¬¦ä¸²
- æŒä¹…åŒ–å˜é‡æœ€å¥½æ˜¯å°äº2kbçš„æ•°æ®ï¼Œå¦‚æœå¼€å‘è€…éœ€è¦å­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨æ•°æ®åº“apiã€‚

:::


1ï¼‰ç®€å•æ•°æ®ç±»å‹çš„æŒä¹…åŒ–ï¼Œå’Œè·å–å’Œä¿®æ”¹


```typescript
import { User } from '../models'

PersistentStorage.PersistProp('count', 100)

@Entry
@Component
struct Index {
  @StorageLink('count')
  count: number = 0

  build() {
    Column({ space: 15 }) {
      Text(this.count.toString())
        .onClick(() => {
          this.count++
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

2ï¼‰å¤æ‚æ•°æ®ç±»å‹çš„æŒä¹…åŒ–ï¼Œå’Œè·å–å’Œä¿®æ”¹

```typescript
import promptAction from '@ohos.promptAction'
import { User } from '../models'

PersistentStorage.PersistProp('userJson', `{ "name": "jack", "age": 18 }`)

@Entry
@Component
struct Index {
  @StorageProp('userJson')
  @Watch('onUpdateUser')
  userJson: string = '{}'
  @State
  user: User = JSON.parse(this.userJson)

  onUpdateUser() {
    this.user = JSON.parse(this.userJson)
  }

  build() {
    Column({ space: 15 }) {
      Text('Indexï¼š')
      Text(this.user.name + this.user.age)
        .onClick(() => {
          this.user.age++
          // ä¿®æ”¹
          AppStorage.Set('userJson', JSON.stringify(this.user))
        })
      Divider()
      Text('Get()')
        .onClick(() => {
          // è·å–
          const user = AppStorage.Get<string>('userJson')
          promptAction.showToast({ message: user })
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

::: tip

- æµ‹è¯•ï¼šéœ€è¦åœ¨çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨è°ƒè¯•

:::

### 4. è®¾å¤‡ç¯å¢ƒ-Environment

> å¼€å‘è€…å¦‚æœéœ€è¦åº”ç”¨ç¨‹åºè¿è¡Œçš„è®¾å¤‡çš„ç¯å¢ƒå‚æ•°ï¼Œä»¥æ­¤æ¥ä½œå‡ºä¸åŒçš„åœºæ™¯åˆ¤æ–­ï¼Œæ¯”å¦‚å¤šè¯­è¨€ï¼Œæš—é»‘æ¨¡å¼ç­‰ï¼Œéœ€è¦ç”¨åˆ° `Environment` è®¾å¤‡ç¯å¢ƒæŸ¥è¯¢ã€‚

- `Environment` çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ä¸å¯å˜çš„ï¼ˆå³åº”ç”¨ä¸å¯å†™å…¥ï¼‰ï¼Œæ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç®€å•ç±»å‹ã€‚

```typescript {5,10-11}
import i18n from '@ohos.i18n';
// è·å–ç³»ç»Ÿè¯­è¨€
const lang = i18n.getSystemLanguage()
// è®¾ç½®ç¯å¢ƒçŠ¶æ€
Environment.EnvProp('lang', lang);

@Entry
@Component
struct Index{
  @StorageProp('lang')
  lang: string = ''

  build() {
    Column() {
      Text(this.lang)
        .onClick(()=>{
          // ä¸èƒ½ä¿®æ”¹
          // Environment.EnvProp('lang', 'en');
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

## ç½‘ç»œç®¡ç†

### 1. åº”ç”¨æƒé™

> ATM (AccessTokenManager) æ˜¯HarmonyOSä¸ŠåŸºäºAccessTokenæ„å»ºçš„ç»Ÿä¸€çš„åº”ç”¨æƒé™ç®¡ç†èƒ½åŠ›ã€‚

åº”ç”¨æƒé™ä¿æŠ¤çš„å¯¹è±¡å¯ä»¥åˆ†ä¸ºæ•°æ®å’ŒåŠŸèƒ½ï¼š

- æ•°æ®åŒ…å«äº†ä¸ªäººæ•°æ®ï¼ˆå¦‚ç…§ç‰‡ã€é€šè®¯å½•ã€æ—¥å†ã€ä½ç½®ç­‰ï¼‰ã€è®¾å¤‡æ•°æ®ï¼ˆå¦‚è®¾å¤‡æ ‡è¯†ã€ç›¸æœºã€éº¦å…‹é£ç­‰ï¼‰ã€åº”ç”¨æ•°æ®ã€‚
- åŠŸèƒ½åˆ™åŒ…æ‹¬äº†è®¾å¤‡åŠŸèƒ½ï¼ˆå¦‚æ‰“ç”µè¯ã€å‘çŸ­ä¿¡ã€è”ç½‘ç­‰ï¼‰ã€åº”ç”¨åŠŸèƒ½ï¼ˆå¦‚å¼¹å‡ºæ‚¬æµ®æ¡†ã€åˆ›å»ºå¿«æ·æ–¹å¼ç­‰ï¼‰ç­‰ã€‚


æ ¹æ®æˆæƒæ–¹å¼çš„ä¸åŒï¼Œæƒé™ç±»å‹å¯åˆ†ä¸ºsystem_grantï¼ˆç³»ç»Ÿæˆæƒï¼‰å’Œuser_grantï¼ˆç”¨æˆ·æˆæƒï¼‰ã€‚
- é…ç½®æ–‡ä»¶æƒé™å£°æ˜
- å‘ç”¨æˆ·ç”³è¯·æˆæƒ


ä¾‹å¦‚ï¼šè®¿é—®ç½‘ç»œéœ€è¦è”ç½‘æƒé™

    <img src="./images/33.png" width="400" />

```json title="module.json5"
{
  "module" : {
    // ...
    "requestPermissions":[
      {
        "name" : "ohos.permission.INTERNET"
      }
    ]
  }
}
```

::: tip
- åº”ç”¨æƒé™[åˆ—è¡¨](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/permission-list-0000001544464017-V3)

:::


### 2. HTTPè¯·æ±‚


1ï¼‰å¯åŠ¨ `json-server` æœåŠ¡ï¼Œ`npm i json-server -g` å…¨å±€å®‰è£…ã€‚

- æ–°å»º `data.json` æ–‡ä»¶åœ¨ä»»æ„ç›®å½•ï¼Œæ¯”å¦‚ `server` æ–‡ä»¶å¤¹

```json
{
  "takeaway": [
    {
      "tag": "318569657",
      "name": "ä¸€äººå¥—é¤",
      "foods": [
        {
          "id": 8078956697,
          "name": "çƒ¤ç¾Šè‚‰ä¸²(10ä¸²)",
          "like_ratio_desc": "å¥½è¯„åº¦100%",
          "month_saled": 40,
          "unit": "10ä¸²",
          "food_tag_list": [
            "ç‚¹è¯„ç½‘å‹æ¨è"
          ],
          "price": 90,
          "picture": "https://zqran.gitee.io/images/waimai/8078956697.jpg",
          "description": "",
          "tag": "318569657",
          "count": 1
        },
        {
          "id": 7384994864,
          "name": "è…Šå‘³ç…²ä»”é¥­",
          "like_ratio_desc": "å¥½è¯„åº¦81%",
          "month_saled": 100,
          "unit": "1äººä»½",
          "food_tag_list": [],
          "price": 39,
          "picture": "https://zqran.gitee.io/images/waimai/7384994864.jpg",
          "description": "",
          "tag": "318569657",
          "count": 1
        },
        {
          "id": 2305772036,
          "name": "é¸¡è…¿èƒ¡èåœç„–é¥­",
          "like_ratio_desc": "å¥½è¯„åº¦91%",
          "month_saled": 300,
          "unit": "1äººä»½",
          "food_tag_list": [],
          "price": 34.32,
          "picture": "https://zqran.gitee.io/images/waimai/2305772036.jpg",
          "description": "ä¸»æ–™ï¼šå¤§ç±³ã€é¸¡è…¿ã€èœå¿ƒã€èƒ¡èåœ",
          "tag": "318569657",
          "count": 1
        },
        {
          "id": 2233861812,
          "name": "å°ä»½é…¸æ±¤èœé¢é±¼é±¼+è‚‰å¤¹é¦å¥—é¤",
          "like_ratio_desc": "å¥½è¯„åº¦73%",
          "month_saled": 600,
          "unit": "1äººä»½",
          "food_tag_list": [
            "â€œå£å‘³å¥½,åŒ…è£…å¾ˆå¥½ï½ç‚¹èµâ€"
          ],
          "price": 34.32,
          "picture": "https://zqran.gitee.io/images/waimai/2233861812.jpg",
          "description": "é…¸æ±¤èœé¢é±¼é±¼ï¼Œä¸»æ–™ï¼šé…¸æ±¤ã€èœé¢ è‚‰å¤¹é¦ï¼Œä¸»æ–™ï¼šç™½çš®é¥¼ã€çŒªè‚‰",
          "tag": "318569657",
          "count": 1
        }
      ]
    },
    {
      "tag": "82022594",
      "name": "ç‰¹è‰²çƒ§çƒ¤",
      "foods": [
        {
          "id": 3823780596,
          "name": "è—¤æ¤’é¸¡è‚‰ä¸²",
          "like_ratio_desc": "",
          "month_saled": 200,
          "unit": "10ä¸²",
          "food_tag_list": [
            "ç‚¹è¯„ç½‘å‹æ¨è"
          ],
          "price": 6,
          "picture": "https://zqran.gitee.io/images/waimai/3823780596.jpg",
          "description": "1ä¸²ã€‚è—¤æ¤’å‘³ï¼Œä¸»æ–™ï¼šé¸¡è‚‰",
          "tag": "82022594",
          "count": 1
        },
        {
          "id": 6592009498,
          "name": "çƒ¤ç¾Šæ’",
          "like_ratio_desc": "",
          "month_saled": 50,
          "unit": "1äººä»½",
          "food_tag_list": [],
          "price": 169,
          "picture": "https://zqran.gitee.io/images/waimai/6592009498.jpg",
          "description": "6-8ä¸ªæœˆè‰åŸç¾”ç¾Šè‚‹æ’ï¼Œçƒ¤åˆ°çš®è„†è‚‰é¦™",
          "tag": "82022594",
          "count": 1
        }
      ]
    },
    {
      "tag": "98147100",
      "name": "æ‚ç²®ä¸»é£Ÿ",
      "foods": [
        {
          "id": 4056954171,
          "name": "äº”å¸¸ç¨»èŠ±é¦™ç±³é¥­",
          "like_ratio_desc": "",
          "month_saled": 1000,
          "unit": "çº¦300å…‹",
          "food_tag_list": [],
          "price": 5,
          "picture": "https://zqran.gitee.io/images/waimai/4056954171.jpg",
          "description": "æµ“æµ“çš„ç¨»ç±³æ¸…é¦™ï¼Œè½¯ç³¯Qå¼¹æœ‰åš¼åŠ²",
          "tag": "98147100",
          "count": 1
        },
        {
          "id": 740430262,
          "name": "å°ç±³å‘ç³•(3ä¸ª)",
          "like_ratio_desc": "å¥½è¯„åº¦100%",
          "month_saled": 100,
          "unit": "3å—",
          "food_tag_list": [],
          "price": 13,
          "picture": "https://zqran.gitee.io/images/waimai/740430262.jpg",
          "description": "æŸ”è½¯è“¬æ¾ï¼Œè‘¡è„å¹²å’Œè”“è¶Šè“é…¸ç”œé€‚å£",
          "tag": "98147100",
          "count": 1
        },
        {
          "id": 7466390504,
          "name": "æ²™æ£ç‰ç±³çªå¤´(3ä¸ª)",
          "like_ratio_desc": "å¥½è¯„åº¦100%",
          "month_saled": 100,
          "unit": "3ä¸ª",
          "food_tag_list": [],
          "price": 13,
          "picture": "https://zqran.gitee.io/images/waimai/7466390504.jpg",
          "description": "",
          "tag": "98147100",
          "count": 1
        }
      ]
    }
  ]
}
```

- è¿›å…¥ `server` æ–‡ä»¶å¤¹ï¼ŒæŒ‰ç…§ä¸‹é¢å‘½ä»¤å¯åŠ¨æ¥å£æœåŠ¡å™¨ï¼ŒæŸ¥çœ‹æœ¬æœºIP `ipconfig | ifconfig`

```bash
json-server data.json --host 192.168.0.1
```

2ï¼‰ä½¿ç”¨ `@ohos.net.http` æ¨¡å—å‘è¯·æ±‚

```typescript
const req = http.createHttp()

req.request('http://192.168.0.1:3000/takeaway')
  .then(res => {
    const data = JSON.parse(res.result as string)
    console.log(data.length)  // === 3  æ³¨æ„ï¼šå­—ç¬¦é•¿åº¦å¤§äº1024å­—èŠ‚ï¼Œæ§åˆ¶å°ä¸å¯è§ã€‚
  })
  .catch(err => {
    console.error('MEITUAN', err.message)
  })
```


## ä»Šæ—¥æ¡ˆä¾‹-ç¾å›¢å¤–å–

|å•†å“é¡µ|è´­ç‰©è½¦|
|----|----|
|<img src="./images/34.png" width="320" />|<img src="./images/35.png" width="320" />|


### 1. é¡µé¢ç»“æ„-å…¥å£é¡µé¢


```typescript title="pages/Index.ets"
import { Cart } from '../components/Cart'
import { Footer } from '../components/Footer'
import { MenuWrapper } from '../components/MenuWrapper'
import { Nav } from '../components/Nav'

@Entry
@Component
struct Index {

  @State
  showCart: boolean = false

  build() {
    Stack({ alignContent: Alignment.Bottom }) {
      Column() {
        Nav()
        MenuWrapper()
      }
      .width('100%')
      .height('100%')
      if (this.showCart) {
        Cart()
      }
      Footer({ showCart: $showCart })
    }
  }
}
```

### 2. é¡µé¢ç»“æ„-åº•éƒ¨ç»„ä»¶

```typescript title="components/Footer.ets"
@Component
export struct Footer {
  @Link
  showCart: boolean

  build() {
    Row() {
      Row() {
        Badge({
          value: '0',
          position: BadgePosition.Right,
          style: { badgeSize: 18 }
        }) {
          Image('https://zqran.gitee.io/images/waimai/cart-2.png')
            .width(47)
            .height(69)
            .position({ y: -19 })
        }
        .width(50)
        .height(50)
        .margin({ left: 25, right: 10 })
        .onClick(() => {
          this.showCart = !this.showCart
        })

        Column() {
          Text() {
            Span('Â¥')
              .fontColor('#fff')
              .fontSize(12)
            Span('0.00')
              .fontColor('#fff')
              .fontSize(24)
          }

          Text('é¢„ä¼°å¦éœ€é…é€è´¹ Â¥5')
            .fontSize(12)
            .fontColor('#999')
        }
        .layoutWeight(1)
        .alignItems(HorizontalAlign.Start)

        Text('å»ç»“ç®—')
          .backgroundColor('#f8c74e')
          .alignSelf(ItemAlign.Stretch)
          .padding(15)
          .borderRadius({
            topRight: 25,
            bottomRight: 25
          })
      }
      .height(50)
      .layoutWeight(1)
      .backgroundColor('#222426')
      .borderRadius(25)
    }
    .padding(15)
    .height(80)
  }
}
```


### 3. é¡µé¢ç»“æ„-å¯¼èˆªç»„ä»¶

```typescript  title="components/Nav.ets"
@Component
export struct Nav {
  @Builder
  NavItem(active: boolean, title: string, subTitle?: string) {
    Column() {
      Text() {
        Span(title)
        if (subTitle) {
          Span(' ' + subTitle)
            .fontSize(10)
            .fontColor(active ? '#000' : '#666')
        }
      }.layoutWeight(1)
      .fontColor(active ? '#000' : '#666')
      .fontWeight(active ? FontWeight.Bold : FontWeight.Normal)

      Text()
        .height(1)
        .width(20)
        .margin({ left: 6 })
        .backgroundColor(active ? '#fa0' : 'transparent')
    }
    .width(73)
    .alignItems(HorizontalAlign.Start)
    .padding({ top: 3 })
  }

  build() {
    Row() {
      this.NavItem(true, 'ç‚¹èœ')
      this.NavItem(false, 'è¯„ä»·', '1796')
      this.NavItem(false, 'å•†å®¶')

      Row() {
        Image($r('app.media.ic_public_input_search'))
          .width(14)
          .aspectRatio(1)
          .fillColor('#999')
        Text('è¯·è¾“å…¥èœå“åç§°')
          .fontSize(12)
          .fontColor('#999')
      }
      .backgroundColor('#eee')
      .height(25)
      .borderRadius(13)
      .padding({ left: 5, right: 5 })
      .layoutWeight(1)
    }
    .padding({ left: 15, right: 15 })
    .height(40)
    .border({ width: { bottom: 0.5 }, color: '#e4e4e4' })
  }
}
```

### 4. é¡µé¢ç»“æ„-å•†å“èœå•å’Œå•†å“åˆ—è¡¨

```typescript title="components/MenuWrapper.ets"

import { MenuWrapperItem } from './MenuWrapperItem'

@Component
export struct MenuWrapper {
  list: string[] = ['ä¸€äººå¥—é¤', 'ç‰¹è‰²çƒ§çƒ¤', 'æ‚ç²®ä¸»é£Ÿ']
  @State
  activeIndex: number = 0

  build() {
    Row() {
      Column() {
        ForEach(this.list, (item: string, index: number) => {
          Text(item)
            .height(50)
            .width('100%')
            .textAlign(TextAlign.Center)
            .fontSize(14)
            .backgroundColor(this.activeIndex === index ? '#fff' : '#f5f5f5')
            .onClick(() => {
              this.activeIndex = index
            })
        })
      }
      .width(90)

      List() {
        ListItem(){
          MenuWrapperItem()
        }
      }
      .layoutWeight(1)
      .height('100%')
      .backgroundColor('#fff')
    }
    .layoutWeight(1)
    .alignItems(VerticalAlign.Top)
    .backgroundColor('#f5f5f5')
  }
}
```

```typescript title="components/MenuWrapperItem.ets"
import { CalcBtn } from './CalcBtn'

@Component
export struct MenuWrapperItem {
  build() {
    Row() {
      Image('https://zqran.gitee.io/images/waimai/8078956697.jpg')
        .width(90)
        .aspectRatio(1)
      Column({ space: 5 }) {
        Text('å°ä»½é…¸æ±¤èœé¢é±¼é±¼+è‚‰å¤¹é¦å¥—é¤')
          .textOverflow({
            overflow: TextOverflow.Ellipsis,
          })
          .maxLines(2)
          .fontWeight(600)
        Text('é…¸æ±¤èœé¢é±¼é±¼ï¼Œä¸»æ–™ï¼šé…¸æ±¤ã€èœé¢ è‚‰å¤¹é¦ï¼Œä¸»æ–™ï¼šç™½çš®é¥¼ã€çŒªè‚‰')
          .textOverflow({
            overflow: TextOverflow.Ellipsis,
          })
          .maxLines(1)
          .fontSize(12)
          .fontColor('#333')
        Text('ç‚¹è¯„ç½‘å‹æ¨è')
          .fontSize(10)
          .backgroundColor('#fff5e2')
          .fontColor('#ff8000')
          .padding({ top: 2, bottom: 2, right: 5, left: 5 })
          .borderRadius(2)
        Text() {
          Span('æœˆé”€å”®40')
          Span(' ')
          Span('å¥½è¯„åº¦100%')
        }
        .fontSize(12)
        .fontColor('#999')

        Row() {
          Text() {
            Span('Â¥ ')
              .fontColor('#ff8000')
              .fontSize(10)
            Span('34.23')
              .fontColor('#ff8000')
              .fontWeight(FontWeight.Bold)
          }

          CalcBtn({ icon: $r('app.media.ic_public_add_filled') })
        }
        .justifyContent(FlexAlign.SpaceBetween)
        .width('100%')
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
      .padding({ left: 10, right: 10 })
    }
    .padding(10)
    .alignItems(VerticalAlign.Top)
  }
}
```

```typescript title="components/CalcBtn.ets"
@Component
export struct CalcBtn {

  icon: Resource

  plain?: boolean

  build() {
    Row() {
      Image(this.icon)
        .width(10)
        .aspectRatio(1)
    }
    .width(16)
    .aspectRatio(1)
    .backgroundColor(this.plain ? '#fff' : '#f8c74e')
    .border(this.plain ? { width: 0.5 , color: '#f8c74e'}: {})
    .borderRadius(4)
    .justifyContent(FlexAlign.Center)
  }
}
```


### 5. é¡µé¢ç»“æ„-è´­ç‰©è½¦

```typescript title="components/Cart.ets"
import { CartItemComp } from './CartItemComp'

@Component
export struct Cart {
  build() {
    Column() {
      Column() {
        Row() {
          Text('è´­ç‰©è½¦')
            .fontSize(12)
            .fontWeight(600)
          Text('æ¸…ç©ºè´­ç‰©è½¦')
            .fontSize(12)
            .fontColor('#999')
        }
        .width('100%')
        .height(40)
        .justifyContent(FlexAlign.SpaceBetween)
        .border({ width: { bottom: 0.5 }, color: '#f5f5f5' })
        .margin({ bottom: 10 })
        .padding({ left: 15, right: 15 })

        List({ space: 30 }) {
          ListItem() {
            CartItemComp()
          }

          ListItem() {
            CartItemComp()
          }

          ListItem() {
            CartItemComp()
          }
        }
        .divider({
          strokeWidth: 0.5,
          color: '#f5f5f5'
        })
        .padding({ left: 15, right: 15, bottom: 100 })
      }
      .backgroundColor('#fff')
      .borderRadius({
        topLeft: 16,
        topRight: 16
      })
    }
    .justifyContent(FlexAlign.End)
    .height('100%')
    .backgroundColor('rgba(0,0,0,0.5)')
  }
}
```

```typescript title="components/CartItem.ets"
import { CalcBtn } from './CalcBtn'

@Component
export struct CartItemComp {
  build() {
    Row() {
      Image('https://zqran.gitee.io/images/waimai/7384994864.jpg')
        .width(60)
        .aspectRatio(1)
        .borderRadius(8)
      Column({ space: 5 }) {
        Text('å°ä»½é…¸æ±¤èœé¢é±¼é±¼+è‚‰å¤¹é¦å¥—é¤')
          .fontSize(14)
          .textOverflow({
            overflow: TextOverflow.Ellipsis
          })
          .maxLines(2)
        Row() {
          Text() {
            Span('Â¥ ')
              .fontColor('#ff8000')
              .fontSize(10)
            Span('34.23')
              .fontColor('#ff8000')
              .fontWeight(FontWeight.Bold)
          }

          Row() {
            CalcBtn({ icon: $r('app.media.ic_screenshot_line'), plain: true })
            Text('0')
              .padding(10)
              .fontSize(12)
            CalcBtn({ icon: $r('app.media.ic_public_add_filled') })
          }
        }
        .justifyContent(FlexAlign.SpaceBetween)
        .width('100%')
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
      .padding({ left: 10, right: 10 })
    }
    .alignItems(VerticalAlign.Top)
  }
}
```

### 6. ä¸šåŠ¡é€»è¾‘-æ¸²æŸ“å•†å“èœå•å’Œåˆ—è¡¨



1ï¼‰å®šä¹‰ model æ•°æ®æ¨¡å‹

```typescript title="models/index.ets"
@Observed
export class FoodItem {
  id: number
  name: string
  like_ratio_desc: string
  food_tag_list: string[]
  price: number
  picture: string
  description: string
  tag: string
  month_saled: number
}

@Observed
export class Category {
  tag: string
  name: string
  foods: FoodItem[]
}
```

2ï¼‰ä½¿ç”¨ `http` å‘é€è¯·æ±‚ï¼Œè·å–æ•°æ®


```typescript {1,6,16,17,19-28,34} title="pages/Index.ets"
import http from '@ohos.net.http'
import { Cart } from '../components/Cart'
import { Footer } from '../components/Footer'
import { MenuWrapper } from '../components/MenuWrapper'
import { Nav } from '../components/Nav'
import { Category } from '../models'

const req = http.createHttp()

@Entry
@Component
struct Index {
  @State
  showCart: boolean = false

  @State
  categoryList: Category[] = []

  aboutToAppear() {
    req.request('http://172.16.39.26:3000/takeaway')
      .then(res => {
        const data = JSON.parse(res.result as string) as Category[]
        this.categoryList = data
      })
      .catch(err => {
        console.error('MEITU', err.message)
      })
  }

  build() {
    Stack({ alignContent: Alignment.Bottom }) {
      Column() {
        Nav()
        MenuWrapper({ categoryList: $categoryList })
      }
      .width('100%')
      .height('100%')

      if (this.showCart) {
        Cart()
      }
      Footer({ showCart: $showCart })
    }
  }
}
```

3ï¼‰ä¼ å…¥åˆ—è¡¨æ•°æ®ç»™ï¼Œå•†å“èœå•ç»„ä»¶ï¼Œè¿›è¡Œæ¸²æŸ“

```typescript {1,6,7,24-34,39-43} title="components/MenuWrapper.ets"
import { Category, FoodItem } from '../models'
import { MenuWrapperItem } from './MenuWrapperItem'

@Component
export struct MenuWrapper {
  @Link
  categoryList: Category[]
  @State
  activeIndex: number = 0

  build() {
    Row() {
      Column() {
        ForEach(this.categoryList, (item: Category, index: number) => {
          Text(item.name)
            .height(50)
            .width('100%')
            .textAlign(TextAlign.Center)
            .fontSize(14)
            .backgroundColor(this.activeIndex === index ? '#fff' : '#f5f5f5')
            .onClick(() => {
              this.activeIndex = index
            })
        })
      }
      .width(90)

      List() {
        ForEach(this.categoryList[this.activeIndex]?.foods, (item: FoodItem) => {
          ListItem() {
            MenuWrapperItem({ food: item })
          }
        })
      }
      .layoutWeight(1)
      .height('100%')
      .backgroundColor('#fff')
    }
    .layoutWeight(1)
    .alignItems(VerticalAlign.Top)
    .backgroundColor('#f5f5f5')
  }
}
```


```typescript {1,7,8,12,16,22,29,30,38,40,50} title="components/MenuWrapperItem.ets"
import { FoodItem } from '../models'
import { CalcBtn } from './CalcBtn'

@Component
export struct MenuWrapperItem {

  @ObjectLink
  food: FoodItem

  build() {
    Row() {
      Image(this.food.picture)
        .width(90)
        .aspectRatio(1)
      Column({ space: 5 }) {
        Text(this.food.name)
          .textOverflow({
            overflow: TextOverflow.Ellipsis,
          })
          .maxLines(2)
          .fontWeight(600)
        Text(this.food.description)
          .textOverflow({
            overflow: TextOverflow.Ellipsis,
          })
          .maxLines(1)
          .fontSize(12)
          .fontColor('#333')
        ForEach(this.food.food_tag_list, (tag) => {
          Text(tag)
            .fontSize(10)
            .backgroundColor('#fff5e2')
            .fontColor('#ff8000')
            .padding({ top: 2, bottom: 2, right: 5, left: 5 })
            .borderRadius(2)
        })
        Text() {
          Span('æœˆé”€å”®'+this.food.month_saled)
          Span(' ')
          Span(this.food.like_ratio_desc)
        }
        .fontSize(12)
        .fontColor('#999')

        Row() {
          Text() {
            Span('Â¥ ')
              .fontColor('#ff8000')
              .fontSize(10)
            Span(this.food.price.toFixed(2))
              .fontColor('#ff8000')
              .fontWeight(FontWeight.Bold)
          }

          CalcBtn({ icon: $r('app.media.ic_public_add_filled') })
        }
        .justifyContent(FlexAlign.SpaceBetween)
        .width('100%')
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
      .padding({ left: 10, right: 10 })
    }
    .padding(10)
    .alignItems(VerticalAlign.Top)
  }
}
```

### 7. ä¸šåŠ¡é€»è¾‘-åŠ å…¥è´­ç‰©è½¦


1ï¼‰è´­ç‰©è½¦æ•°æ®æ¨¡å‹

```typescript title="models/index.ets"
@Observed
export class CartItem {
  id: number
  name: string
  price: number
  picture: string
  count: number
}
```

2ï¼‰è´­ç‰©è½¦æ·»åŠ é€»è¾‘

```typescript title="utils/index.ets"
import { CartItem, FoodItem } from '../models'

export const CART_KEY = 'CART_KEY'

export const getCart = () => {
  return JSON.parse(AppStorage.Get(CART_KEY) || '[]') as CartItem[]
}

export const addCart = (food: FoodItem) => {
  const cart = getCart()
  const f = cart.find(f => f.id === food.id)
  if (f) {
    f.count++
  } else {
    const { id, price, picture, name } = food
    cart.unshift({
      id,
      price,
      picture,
      name,
      count: 1
    })
  }
  AppStorage.Set(CART_KEY, JSON.stringify(cart))
}
```

3ï¼‰è´­ç‰©è½¦çŠ¶æ€æŒä¹…åŒ–

```typescript title="pages/Index.ets"
import { CART_KEY } from '../utils'


PersistentStorage.PersistProp(CART_KEY, '[]')
```


4ï¼‰ç›‘å¬è´­ç‰©è½¦æ•°æ®å˜åŒ–ï¼Œè®¾ç½®è´­ç‰©è½¦çŠ¶æ€ï¼Œåº•éƒ¨ç»„ä»¶æ˜¾ç¤ºæ•°é‡å’Œæ€»ä»·

```typescript title="pages/Index.ets"
  @StorageProp(CART_KEY)
  @Watch('onUpdateCart')
  cartJson: string = '[]'
  @State
  cart: CartItem[] = JSON.parse(this.cartJson)
  onUpdateCart () {
    this.cart = JSON.parse(this.cartJson)
  }
```

```typescript title="pages/Index.ets"
Footer({ showCart: $showCart, cart: $cart })
```

```typescript title="components/Footer.ets"
@Link
cart: CartItem[]

  // ...
          Badge({
          value: this.cart.reduce((p, c) => p + c.count, 0) + '',
          })

  // ...
          Span(this.cart.reduce((p, c) => p + (c.count * c.price * 100) / 100, 0).toFixed(2))
          .fontColor('#fff')
          .fontSize(24)

```


5ï¼‰æ·»åŠ è´­ç‰©è½¦

```typescript title="components/MenuWrapperItem.ets"
          CalcBtn({ icon: $r('app.media.ic_public_add_filled') })
            .onClick(() => {
              addCart(this.food)
              promptAction.showToast({ message: 'æ·»åŠ è´­ç‰©è½¦æˆåŠŸ' })
            })
```



### 7. ä¸šåŠ¡é€»è¾‘-è´­ç‰©è½¦ç®¡ç†

1ï¼‰æ¸²æŸ“è´­ç‰©è½¦

```typescript title="pages/Index.ets"
      if (this.showCart) {
        Cart({ cart: $cart })
      }
```

```typescript title="components/Cart.ets"
@Component
export struct Cart {
  @Link
  cart: CartItem[]

  // ...

          List({ space: 30 }) {
          ForEach(this.cart, (item:CartItem) => {
            ListItem() {
              CartItemComp({ item })
            }
          })
        }
```

```typescript title="components/CartItem.ets"
import { CartItem } from '../models'
import { CalcBtn } from './CalcBtn'

@Component
export struct CartItemComp {

  @ObjectLink
  item: CartItem

  build() {
    Row() {
      Image(this.item.picture)
        .width(60)
        .aspectRatio(1)
        .borderRadius(8)
      Column({ space: 5 }) {
        Text(this.item.name)
          .fontSize(14)
          .textOverflow({
            overflow: TextOverflow.Ellipsis
          })
          .maxLines(2)
        Row() {
          Text() {
            Span('Â¥ ')
              .fontColor('#ff8000')
              .fontSize(10)
            Span(this.item.price.toFixed(2))
              .fontColor('#ff8000')
              .fontWeight(FontWeight.Bold)
          }

          Row() {
            CalcBtn({ icon: $r('app.media.ic_screenshot_line'), plain: true })
            Text(this.item.count+'')
              .padding(10)
              .fontSize(12)
            CalcBtn({ icon: $r('app.media.ic_public_add_filled') })
          }
        }
        .justifyContent(FlexAlign.SpaceBetween)
        .width('100%')
      }
      .layoutWeight(1)
      .alignItems(HorizontalAlign.Start)
      .padding({ left: 10, right: 10 })
    }
    .alignItems(VerticalAlign.Top)
  }
}
```


2ï¼‰è´­ç‰©è½¦æ•°é‡ä¿®æ”¹

```typescript title="utils/index.ets"
export const addCart = (food: FoodItem | CartItem) => { ... }

export const delCart = (id: number) => {
  const cart = getCart()
  const f = cart.find(f => f.id === id)
  if (f && f.count > 0) {
    f.count--
  }
  AppStorage.Set(CART_KEY, JSON.stringify(cart))
}
```

```typescript title="components/CartItem.ets"
            CalcBtn({ icon: $r('app.media.ic_screenshot_line'), plain: true })
              .onClick(() => {
                delCart(this.item.id)
              })
            Text(this.item.count+'')
              .padding(10)
              .fontSize(12)
            CalcBtn({ icon: $r('app.media.ic_public_add_filled') })
              .onClick(()=>{
                addCart(this.item)
              })
```


3ï¼‰æ¸…ç©ºè´­ç‰©è½¦


```typescript title="utils/index.ets"
export const clearCart  = () => {
  AppStorage.Set(CART_KEY, '[]')
}
```

```typescript title="components/Cart.ets"
          Text('æ¸…ç©ºè´­ç‰©è½¦')
            .fontSize(12)
            .fontColor('#999')
            .onClick(() => {
              clearCart()
            })
```

